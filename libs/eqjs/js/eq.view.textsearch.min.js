(function(n,t){var i=t.EQ=t.EQ||{};i.view=i.view||{};i.view.textsearch={_resultPanel:null,_applyTextSearchButton:null,_clearTextButton:null,_funcs:{},_useHighlightForTextSearch:!1,_textSearchInputId:null,_findControlById:function(t){var i=n("#"+t);return i.length==0&&(i=null),i},init:function(i){var u,f,e,o,s,r;if(i=i||t.easyQueryViewSettings||{},u=i.resultPanelId||"ResultPanel",this._resultPanel=this._findControlById(u),f=i.resultCountSpanId||"ResultCount",this._resultCountSpan=this._findControlById(f),e=i.applyTextSearchButtonId||"ApplyTextSearchButton",this._applyTextSearchButton=this._findControlById(e),o=i.textSearchInputId||"TextSearchInput",this._textSearchInputId=this._findControlById(o),s=i.clearTextSearchButtonId||"ClearTextSearchButton",this._clearTextButton=this._findControlById(s),typeof i.useHighlightForTextSearch!="undefined"&&(this._useHighlightForTextSearch=i.useHighlightForTextSearch),this.showChart=typeof i.showChart!="undefined"?i.showChart:!0,this.pagingOptions=i.paging,r=this,this.serviceUrl=typeof i.serviceUrl!="undefined"?i.serviceUrl:"/EasyQuery/",this.useBootstrap=typeof i.useBootstrap!="undefined"?i.useBootstrap:!1,this.applyTextSearchUrl=i.applyTextSearchUrl||this.combinePath(this.serviceUrl,"ApplyTextSearch"),this.applyTextSearch({page:1}),this._funcs.clearButtonClick||(r=this,this._funcs.clearButtonClick=function(){n(r._textSearchInputId).val("")}),this._clearTextButton){this._clearTextButton.off("click",this._funcs.clearButtonClick);this._clearTextButton.on("click",this._funcs.clearButtonClick)}if(this._funcs.applyTextSearchButtonClick||(r=this,this._funcs.applyTextSearchButtonClick=function(){r.applyTextSearch({page:1})}),this._applyTextSearchButton){this._applyTextSearchButton.off("click",this._funcs.applyTextSearchButtonClick);this._applyTextSearchButton.on("click",this._funcs.applyTextSearchButtonClick)}n(this._textSearchInputId).keypress(function(n){n.which==13&&r._funcs.applyTextSearchButtonClick()})},_clearErrorsInPanel:function(n){n&&(n.hasClass("error")&&n.removeClass("error"),n.empty())},_clearErrors:function(){this._clearErrorsInPanel(this._resultPanel)},_clearResultPanel:function(){this._resultPanel&&this._resultPanel.empty();this._exportButtons&&this._exportButtons.hide();this._resultCountSpan&&this._resultCountSpan.hide()},applyTextSearch:function(t){var r=this,u,e,h=n(r._textSearchInputId).val()||"",f=n("<div><\/div>",{"class":"result-panel loader"}),o,s,i;t=t||{};t.page||(o=r.getCurrentPaging(),t.page=o.page);s={text:h,options:t};i=r._resultPanel;n.ajax({type:"POST",contentType:"application/json",url:r.applyTextSearchUrl,data:JSON.stringify(s),beforeSend:function(){i&&(i.animate({opacity:"0.5"},200),i.html(f))},success:function(t){try{if(i){if(i.html(t),u=r.getCurrentPaging(),u.pageCount>1){var o=n("#PageNavigator");o.length>0&&(e=r.renderPageNavigator({pageIndex:u.pageIndex,pageCount:u.pageCount,pageSelectedCallback:function(n){r.applyTextSearch({page:n})}}),o.append(e))}i.animate({opacity:1},200);r._useHighlightForTextSearch&&r.highlightTextSearch()}}finally{f.remove()}},error:function(n,t,r){f.remove();i&&(i.empty(),i.append("<div><\/div>").addClass("error").append("<div>Error during "+r+" request:  <div>"+t+"<\/div><\/div>"))}})},highlightTextSearch:function(){var t=n(this._textSearchInputId).val().toLowerCase(),i="<span style='background-color: yellow'>",r="<\/span>";t!==""&&n("td").each(function(){var h=n(this).text().toLowerCase().indexOf(t),s,u;if(h>=0){for(var o=0,e=n(this).text(),f=[];;)if(s=n(this).text().toLowerCase().indexOf(t,o),s>=0?(f.push(s),o=s+t.length):o++,o>=e.length-1)break;if(f.length>0)for(n(this).text(""),u=0;u<f.length;u++)u===0&&n(this).append(e.substring(0,f[u])),n(this).append(i+e.substring(f[u],f[u]+t.length)+r),u<f.length-1?n(this).append(e.substring(f[u]+t.length,f[u+1])):n(this).append(e.substring(f[u]+t.length))}})},renderPageNavigator:function(t){var f=this,a=t.pageIndex||1,c=t.pageCount||1,l=function(){var i=n(this).data("page");t.pageSelectedCallback&&t.pageSelectedCallback(i)},v=t.maxButtonCount||10,y=a-1,h=y-y%v+1,o=h+v-1,e,u,r,s;if(o>c&&(o=c),e=n("<ul><\/ul>"),f.useBootstrap?e.addClass("pagination"):e.addClass("eqview-pagination"),t.cssClass&&e.addClass(t.cssClass),u=n("<li><\/li>"),f.useBootstrap&&u.addClass("page-item"),r=n("<span aria-hidden='true'>&laquo;<\/span>"),f.useBootstrap&&r.addClass("page-link"),h==1)u.addClass("disabled");else{f.useBootstrap?(r=n("<a href='javascript:void(0)' data-page='"+(h-1)+"'>&laquo;<\/a>"),r.addClass("page-link")):r=n("<a href='javascript:void(0)' data-page='"+(h-1)+"'><\/a>").append(r);r.on("click",l)}for(u.append(r),e.append(u),s=h;s<=o;s++){u=n("<li><\/li>");f.useBootstrap&&u.addClass("page-item");s==a&&u.addClass("active");r=n("<a href='javascript:void(0)' class='page-link' data-page='"+s+"'>"+s+"<\/a>");f.useBootstrap&&r.addClass("page-link");r.on("click",l);u.append(r);e.append(u)}if(u=n("<li><\/li>"),f.useBootstrap&&u.addClass("page-item"),r=n("<span aria-hidden='true'>&raquo;<\/span>"),f.useBootstrap&&r.addClass("page-link"),o==c)u.addClass("disabled");else{i.client.useBootstrap?(r=n("<a href='javascript:void(0)' data-page='"+(o+1)+"'>&raquo;<\/a>"),r.addClass("page-link")):r=n("<a href='javascript:void(0)' data-page='"+(o+1)+"'><\/a>").append(r);r.on("click",l)}return u.append(r),e.append(u),e},getCurrentPaging:function(){var t,i,r;return result={pageIndex:1,pageCount:1},t=n("#PageNavigator"),t.length>0&&(i=t.data("pageindex"),r=t.data("pagecount"),i&&(result.pageIndex=i),r&&(result.pageCount=r)),result},combinePath:function(n,t){var i=n;return i!=null&&i.length>0?(i.charAt(i.length-1)!="/"&&(i+="/"),i+=t):i=t,i}};n(function(){i.view.textsearch.init()})})(jQuery,window);